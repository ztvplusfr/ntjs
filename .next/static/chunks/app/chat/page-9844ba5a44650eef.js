(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{638:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(5143).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},2156:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(5143).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},3554:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(5143).A)("film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]])},3806:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(5143).A)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]])},5044:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(5143).A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]])},8078:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>j});var s=a(2501),r=a(7841),l=a(1308),n=a(5143);let c=(0,n.A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),i=(0,n.A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),o=(0,n.A)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);var d=a(3806);let h=(0,n.A)("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var m=a(638),u=a(5044),x=a(2156);let g=(0,n.A)("square-plus",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var y=a(3554);let p=(0,n.A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);var v=a(2997),f=a.n(v);function j(){var e;let{data:t}=(0,l.useSession)(),[a,n]=(0,r.useState)([]),[v,j]=(0,r.useState)(!0),[b,N]=(0,r.useState)(""),[k,w]=(0,r.useState)(!1),[M,A]=(0,r.useState)(""),[z,C]=(0,r.useState)(null),[E,S]=(0,r.useState)(null),D=(0,r.useRef)(null),I=(0,r.useRef)(null),L=(0,r.useRef)(null),R=async()=>{try{let t=Date.now(),a=await fetch("/api/discord/chat-messages?t=".concat(t),{cache:"no-store",headers:{"Cache-Control":"no-cache"}}),s=await a.json();if(a.ok){var e;console.log("Received ".concat((null==(e=s.messages)?void 0:e.length)||0," messages from API")),n(s.messages||[]),N("")}else N(s.error||"Erreur lors de la r\xe9cup\xe9ration des messages")}catch(e){console.error("Fetch error:",e),N("Erreur de connexion au serveur")}finally{j(!1)}};(0,r.useEffect)(()=>{R()},[]),(0,r.useEffect)(()=>{var e;null==(e=D.current)||e.scrollIntoView({behavior:"smooth"})},[a]),(0,r.useEffect)(()=>(k?L.current=setInterval(R,5e3):L.current&&clearInterval(L.current),()=>{L.current&&clearInterval(L.current)}),[k]);let _=async()=>{if(M.trim()||z)try{var e,a,s;let r=new FormData;r.append("content",M),r.append("userName",(null==t||null==(e=t.user)?void 0:e.name)||"Utilisateur"),r.append("userAvatar",(null==t||null==(a=t.user)?void 0:a.image)||""),r.append("userId",(null==t||null==(s=t.user)?void 0:s.id)||""),z&&r.append("image",z);let l=await fetch("/api/discord/chat",{method:"POST",body:r});if(l.ok)A(""),C(null),S(null),I.current&&(I.current.value=""),R();else{let e=await l.json();N(e.error||"Erreur lors de l'envoi")}}catch(e){N("Erreur de connexion")}};return v?(0,s.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-gray-700 border-t-sky-500 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Chargement..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-black text-white flex flex-col border-l border-gray-800",children:[(0,s.jsx)("div",{className:"bg-black border-b-2 border-gray-700 px-4 py-3 sticky top-0 z-40 shadow-lg",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(f(),{href:"/",className:"text-gray-400 hover:text-white transition-colors",children:(0,s.jsx)(c,{size:24})}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("img",{src:"/image.png",alt:"Image",className:"w-32 h-10 object-contain"}),(0,s.jsx)("span",{className:"text-gray-400 font-bold text-lg",children:"\xd7"}),(0,s.jsx)("img",{src:"/tchatter-logo.png",alt:"TChatter",className:"w-32 h-10 object-contain"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-lg",children:"DISCORD - ZTVPLUS"}),(0,s.jsx)("p",{className:"text-green-400 text-xs",children:"En ligne"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>w(!k),className:"p-2 rounded-full transition-colors ".concat(k?"text-green-400 hover:bg-green-900/20":"text-gray-400 hover:bg-gray-800"),children:(0,s.jsx)(i,{size:20,className:k?"animate-spin":""})}),(0,s.jsx)("button",{className:"text-gray-400 hover:bg-gray-800 p-2 rounded-full transition-colors",children:(0,s.jsx)(o,{size:20})})]})]})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto bg-black",children:[b&&(0,s.jsx)("div",{className:"bg-red-900/50 border border-red-800 rounded-lg p-4 m-4",children:(0,s.jsx)("p",{className:"text-red-400",children:b})}),0===a.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(d.A,{size:48,className:"text-gray-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Aucun message trouv\xe9"}),(0,s.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"Soyez le premier \xe0 envoyer un message !"})]}):(0,s.jsxs)("div",{className:"p-4 space-y-4",children:[a.map(e=>{var a,r,l,n;let c=(e=>{var a,s,r,l;if(!(null==t||null==(a=t.user)?void 0:a.name))return!1;let n="@".concat(t.user.name.toLowerCase().replace(/\s+/g,"_")),c="**".concat(t.user.name,"**"),i=null==(s=e.content)?void 0:s.startsWith(n),o=null==(r=e.content)?void 0:r.startsWith(c);return("tChatter"===e.author.username||"1201229706603798619"===e.author.id||e.author.username.includes("Bot"))&&(i||o)?(console.log("Detected own message: ".concat(n,"/").concat(c," - ").concat(null==(l=e.content)?void 0:l.substring(0,30),"...")),!0):!!t.user.id&&t.user.id===e.author.id&&(console.log("Detected own message by ID: ".concat(t.user.id)),!0)})(e),i=c?{displayName:(null==t||null==(a=t.user)?void 0:a.name)||"Moi",username:(null==t||null==(l=t.user)||null==(r=l.name)?void 0:r.toLowerCase().replace(/\s+/g,"_"))||"moi",avatar:(null==t||null==(n=t.user)?void 0:n.image)||"https://cdn.discordapp.com/embed/avatars/0.png"}:e.author;return(0,s.jsx)("div",{className:"flex ".concat(c?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"flex ".concat(c?"flex-row-reverse":"flex-row"," gap-2 max-w-[70%]"),children:[!c&&(0,s.jsx)("img",{src:i.avatar,alt:i.displayName,className:"w-8 h-8 rounded-full object-cover flex-shrink-0"}),(0,s.jsxs)("div",{className:"".concat(c?"items-end":"items-start"," flex flex-col"),children:[!c&&(0,s.jsx)("p",{className:"text-xs font-semibold text-gray-400 mb-1",children:i.displayName}),(0,s.jsx)("div",{className:"rounded-2xl px-4 py-2 ".concat(c?"bg-sky-500 text-white":"bg-gray-800 text-gray-100"),children:(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:c?(()=>{var a,s,r;let l="@".concat((null==t||null==(s=t.user)||null==(a=s.name)?void 0:a.toLowerCase().replace(/\s+/g,"_"))||""),n="\\*\\*".concat((null==t||null==(r=t.user)?void 0:r.name)||"","\\*\\*"),c=e.content;return c=(c=c.replace(RegExp("^".concat(l,"\\s*"),"m"),"").trim()).replace(RegExp("^".concat(n,"\\s*"),"m"),"").trim(),console.log('Cleaned content: "'.concat(c,'"')),c||e.content})():e.content})}),e.attachments&&e.attachments.length>0&&(0,s.jsx)("div",{className:"mt-1 space-y-1 ".concat(c?"items-end":"items-start"," flex flex-col"),children:e.attachments.map(e=>(0,s.jsx)("div",{className:"rounded-lg overflow-hidden max-w-sm ".concat(c?"bg-sky-900/50":"bg-gray-800 border border-gray-700"),children:e.isImage?(0,s.jsx)("img",{src:e.url,alt:e.filename,className:"w-full max-h-48 object-cover"}):(0,s.jsxs)("div",{className:"p-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.A,{size:16,className:c?"text-sky-400":"text-gray-500"}),(0,s.jsx)("span",{className:"text-xs font-medium truncate text-gray-200",children:e.filename}),(0,s.jsx)("span",{className:"text-xs text-gray-400",children:(e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["Bytes","KB","MB","GB"][t]})(e.size)})]}),(0,s.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs font-medium mt-1 inline-block ".concat(c?"text-sky-400":"text-sky-500"," hover:underline"),children:"T\xe9l\xe9charger"})]})},e.id))}),(0,s.jsx)("p",{className:"text-xs mt-1 ".concat(c?"text-gray-500 text-right":"text-gray-400"),children:(e=>{let t=new Date(e),a=(new Date().getTime()-t.getTime())/36e5;return a<.1?"\xe0 l'instant":a<1?"il y a ".concat(Math.floor(60*a)," min"):a<24?"il y a ".concat(Math.floor(a)," h"):t.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})})(e.timestamp)})]})]})},e.id)}),(0,s.jsx)("div",{ref:D})]})]}),E&&(0,s.jsx)("div",{className:"bg-black border-t border-gray-800 p-2 shadow-md",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("img",{src:E,alt:"Preview",className:"w-12 h-12 rounded-lg object-cover border border-gray-800"}),(0,s.jsx)("span",{className:"text-sm text-gray-300 truncate flex-1",children:null==z?void 0:z.name}),(0,s.jsx)("button",{onClick:()=>{C(null),S(null),I.current&&(I.current.value="")},className:"text-gray-400 hover:text-white p-1 rounded hover:bg-gray-800 transition-colors",children:"âœ•"})]})}),(0,s.jsx)("div",{className:"bg-black border-t-2 border-gray-700 p-4 sticky bottom-0 z-30 shadow-lg",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{ref:I,type:"file",accept:"image/*",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){if(a.size>8388608)return void N("L'image ne doit pas d\xe9passer 8MB");if(!a.type.startsWith("image/"))return void N("Le fichier doit \xeatre une image");C(a),N("");let e=new FileReader;e.onload=e=>{var t;S(null==(t=e.target)?void 0:t.result)},e.readAsDataURL(a)}},className:"hidden"}),(0,s.jsx)("button",{onClick:()=>{var e;return null==(e=I.current)?void 0:e.click()},className:"text-gray-400 hover:text-white hover:bg-gray-800 p-2 rounded-lg transition-colors",children:(0,s.jsx)(h,{size:24})}),(0,s.jsx)("div",{className:"flex-1 bg-gray-800 rounded-full px-4 py-2 flex items-center border border-gray-700",children:(0,s.jsx)("input",{type:"text",value:M,onChange:e=>A(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())},placeholder:"Envoyer un message...",className:"flex-1 bg-transparent outline-none text-sm text-white placeholder-gray-500"})}),(0,s.jsx)("button",{onClick:_,disabled:!M.trim()&&!z,className:"p-2 rounded-lg transition-colors ".concat(M.trim()||z?"text-sky-400 hover:text-sky-300 hover:bg-gray-800":"text-gray-600 cursor-not-allowed"),children:(0,s.jsx)(m.A,{size:24})})]})}),(0,s.jsx)("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 z-50",children:(0,s.jsxs)("div",{className:"flex items-center justify-around py-2",children:[(0,s.jsx)(f(),{href:"/",className:"p-2 text-gray-400 hover:text-white transition-colors",children:(0,s.jsx)(u.A,{size:24})}),(0,s.jsx)(f(),{href:"/search",className:"p-2 text-gray-400 hover:text-white transition-colors",children:(0,s.jsx)(x.A,{size:24})}),(0,s.jsx)("button",{className:"p-2 text-gray-400 hover:text-white transition-colors",children:(0,s.jsx)(g,{size:24})}),(0,s.jsx)(f(),{href:"/chat",className:"p-2 text-sky-400",children:(0,s.jsx)(y.A,{size:24})}),(0,s.jsx)("div",{className:"p-2",children:(null==t||null==(e=t.user)?void 0:e.image)?(0,s.jsx)("img",{src:t.user.image,alt:"Profile",className:"w-6 h-6 rounded-full object-cover"}):(0,s.jsx)(p,{size:24,className:"text-gray-400"})})]})})]})}},8870:(e,t,a)=>{Promise.resolve().then(a.bind(a,8078))}},e=>{e.O(0,[879,308,698,573,358],()=>e(e.s=8870)),_N_E=e.O()}]);